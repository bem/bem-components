# popup

Блок `popup` используется для создания выпадающих элементов и позволяет изменять их состояние, поведение и внешний вид. Блок всегда отображается поверх остальных элементов страницы.

Попап может быть вызван различными элементами страницы, например, кнопками или псевдоссылками.

При первом открытии попапа DOM-элемент блока переносится в конце `<body>`. Блок получает модификатор `visible`.

## Инициализация блока

Чтобы попап отображался при установке модификатора `visible`, блок должен быть предварительно инициализирован. Для этого служит метод `setTarget`. В ходе выполнения методу необходимо определить положение попапа на странице. Это может осуществляться:

* исходя из положения на странице родительского элемента. В этом случае методу `setTarget` следует передать аргументом родительский DOM-элемент или БЭМ-блок;
* путем явного указания координат. Первым аргументом методу `setTarget` передается значение отступа от левого края страницы, вторым отступ сверху: `setTarget(x-coordinate, y-coordinate)`.

Метод `setTarget` возвращает объект `this`.

## Специализированные поля блока

Список зарезервированных полей входного BEMJSON:

<table>
    <tr>
        <th>Поле</th>
        <th>Тип</th>
        <th>Описание</th>
    </tr>
    <tr>
        <td>directions</td>
        <td>
            <code>Массив</code>
        </td>
        <td>Управляет <a href="#directions">направлением открытия попапа</a> (например, <code>bottom-left</code>, где <code>bottom</code> является основным параметром, <code>left</code> - второстепенным) на странице относительно вызвавшего его элемета.</td>
    </tr>
    <tr>
        <td>mainOffset</td>
        <td>
            <code>String</code>
        </td>
        <td>Задает смещение попапа относительно основного направления.</td>
    </tr>
    <tr>
        <td>secondaryOffset</td>
        <td>
            <code>BEMJSON</code></td>
        <td>Задает смещение попапа относительно второстепенного направления.</td>
    </tr>
    <tr>
        <td>viewportOffset</td>
        <td>
            <code>String</code>
        </td>
        <td>Задает смещение попапа от края окна браузера.</td>
    </tr>
    <tr>
        <td>zIndexGroupLevel</td>
        <td>
            <code>String</code>
        </td>
        <td>Позволяет задать уровень слоя для открывающихся попапов. Основан на блоке <a href="../z-index-group/z-index.group.ru.md">z-index-group</a></td>
    </tr>
</table>

При необходимости дополнительные HTML-атрибуты блока могут быть заданы в зарезервированном поле `attrs` в BEMJSON.

## Модификаторы блока

### Темы `_theme`

Блок представлен в следующих темах:

 * simple
 * islands

Без указания модификатора `theme` отображается [нативный](#native) вид контрола.

Наглядно видно на примерах ниже:

<a name="native"></a>
**default**

```
{
    block : 'popup',
    content : 'default'
}
```

**simple**

```
{
    block : 'popup',
    mods : { theme : 'simple' },
    content : 'simple'
}
```

**islands**

```
{
    block : 'popup',
    mods : { theme : 'islands' },
    content : 'islands'
}
```

### Видимый `_visible`

Модификатор `visible` выставляется блоку автоматически при открытии попапа. Когда попап скрыт, модификатор удаляется.

**NB:** данная реализация блока не поддерживает принудительную установку модификатора `visible` в BEMJSON-декларации.

#### `_autoclosable`

Модификатор `autoclosable` скрывает блок по щелчку мыши вне зоны попапа.

```
{
    block : 'popup',
    mods : { theme : 'islands', autoclosable : true },
    content : 'islands'
}
```

<a href="direction"></a>
## Расположение относительно родителя `_direction`

Поле `direction` управляет направлением открытия попапа на странице относительно вызвавшего его элемета. Расположение блока определяется автоматически, исходя из массива допустимых направлений и положения родителя на странице.

По умолчанию используется следующий массив допустимых направлений:

* bottom-left
* bottom-center
* bottom-right
* top-left
* top-center
* top-right
* right-top
* right-center
* right-bottom
* left-top
* left-center
* left-bottom

Чтобы управлять расположением попапа, можно ограничить массив направлений открытия, оставив только требуемые. Пользовательский массив нужно передать в качестве JS-параметра с ключом `directions`. При этом из значений массива будет выбрано наиболее подходящее, исходя из положения родителя на странице.

Например, если требуется, чтобы попап раскрывался над родителем:

```
{
    block : 'popup',
    mods : { autoclosable : true, theme: 'simple' },
    directions : ['top-left', 'top-center', 'top-right'],
    content : 'Hello, world!'
}
```

Или небходимо разместить попап справа по центру:

```
{
    block : 'popup',
    mods : { autoclosable : true, theme: 'simple' },
    directions : ['right-center'],
    content : 'Hello, world!'
}
```

Используйте поля `mainOffset` и/или `secondaryOffset` для управления направлением смещения.

```
{
    block : 'popup',
    mods : { autoclosable : true, theme: 'islands' },
    direction : ['right-center'],
    mainOffset : 100,
    secondaryOffset : 100,
    content : 'Hello, world!'
}
```

## Взаимосвязи между popup'ами

Блок `popup` поддерживает вложенную структуру нескольких одновременно открытых попапов. Это означает, что один попап может вызывать второй, а второй, соответственно, может вызвать третий и так далее. И при этом все попапы будут оставаться открытыми.

Если установлен модификатор `autoclosable` в значении `true`, то при щелчке мышью вне зоны попапа, попап закроется сам и закроет свои дочерние блоки.

Дочерние блоки popup можно рассматривать в виде цепочки `1` → `2` → `3` → `4`. При клике на втором попапе – закрываются третий и четвертый. При клике в первом – закрываются второй, третий, четвертый. При клике за пределами любого попапа из цепочки – закроются все.
